{"filter":false,"title":"lambda_sqs.tf","tooltip":"/eksamen-2024/infra/lambda_sqs.tf","undoManager":{"mark":13,"position":13,"stack":[[{"start":{"row":0,"column":0},"end":{"row":63,"column":0},"action":"insert","lines":["# Opprett SQS-k√∏","resource \"aws_sqs_queue\" \"image_processing_queue\" {","  name                        = \"image-processing-queue\"","  visibility_timeout_seconds  = 30 # Maks behandlingstid for Lambda","}","","# IAM-rolle for Lambda","resource \"aws_iam_role\" \"lambda_execution_role\" {","  name = \"lambda-execution-role\"","","  assume_role_policy = jsonencode({","    Version = \"2012-10-17\"","    Statement = [","      {","        Action    = \"sts:AssumeRole\"","        Effect    = \"Allow\"","        Principal = {","          Service = \"lambda.amazonaws.com\"","        }","      }","    ]","  })","}","","# IAM-policy for tilgang til SQS, S3 og logging","resource \"aws_iam_role_policy\" \"lambda_policy\" {","  name = \"lambda-sqs-s3-policy\"","  role = aws_iam_role.lambda_execution_role.id","","  policy = jsonencode({","    Version = \"2012-10-17\"","    Statement = [","      # SQS-tilgang","      {","        Action = [","          \"sqs:ReceiveMessage\",","          \"sqs:DeleteMessage\",","          \"sqs:GetQueueAttributes\"","        ]","        Effect   = \"Allow\"","        Resource = aws_sqs_queue.image_processing_queue.arn","      },","      # S3-tilgang","      {","        Action = [","          \"s3:PutObject\"","        ]","        Effect   = \"Allow\"","        Resource = \"arn:aws:s3:::pgr301-couch-explorers/*\"","      },","      # Logging-tilgang","      {","        Action = [","          \"logs:CreateLogGroup\",","          \"logs:CreateLogStream\",","          \"logs:PutLogEvents\"","        ]","        Effect = \"Allow\"","        Resource = \"arn:aws:logs:*:*:*\"","      }","    ]","  })","}",""],"id":1}],[{"start":{"row":27,"column":45},"end":{"row":27,"column":46},"action":"remove","lines":["d"],"id":2},{"start":{"row":27,"column":44},"end":{"row":27,"column":45},"action":"remove","lines":["i"]}],[{"start":{"row":27,"column":44},"end":{"row":27,"column":45},"action":"insert","lines":["a"],"id":3},{"start":{"row":27,"column":45},"end":{"row":27,"column":46},"action":"insert","lines":["r"]},{"start":{"row":27,"column":46},"end":{"row":27,"column":47},"action":"insert","lines":["n"]}],[{"start":{"row":1,"column":48},"end":{"row":1,"column":49},"action":"insert","lines":["_"],"id":4},{"start":{"row":1,"column":49},"end":{"row":1,"column":50},"action":"insert","lines":["_"]}],[{"start":{"row":1,"column":49},"end":{"row":1,"column":50},"action":"remove","lines":["_"],"id":5}],[{"start":{"row":1,"column":49},"end":{"row":1,"column":50},"action":"insert","lines":["2"],"id":6},{"start":{"row":1,"column":50},"end":{"row":1,"column":51},"action":"insert","lines":["7"]}],[{"start":{"row":2,"column":55},"end":{"row":2,"column":56},"action":"insert","lines":["_"],"id":7},{"start":{"row":2,"column":56},"end":{"row":2,"column":57},"action":"insert","lines":["2"]},{"start":{"row":2,"column":57},"end":{"row":2,"column":58},"action":"insert","lines":["7"]}],[{"start":{"row":40,"column":55},"end":{"row":40,"column":56},"action":"insert","lines":["_"],"id":8},{"start":{"row":40,"column":56},"end":{"row":40,"column":57},"action":"insert","lines":["2"]},{"start":{"row":40,"column":57},"end":{"row":40,"column":58},"action":"insert","lines":["7"]}],[{"start":{"row":27,"column":9},"end":{"row":27,"column":47},"action":"remove","lines":["aws_iam_role.lambda_execution_role.arn"],"id":13},{"start":{"row":27,"column":9},"end":{"row":27,"column":62},"action":"insert","lines":["arn:aws:iam::244530008913:role/service-role/myRole-27"]}],[{"start":{"row":27,"column":9},"end":{"row":27,"column":10},"action":"insert","lines":["\""],"id":14}],[{"start":{"row":27,"column":63},"end":{"row":27,"column":64},"action":"insert","lines":["\""],"id":15}],[{"start":{"row":24,"column":0},"end":{"row":62,"column":1},"action":"remove","lines":["# IAM-policy for tilgang til SQS, S3 og logging","resource \"aws_iam_role_policy\" \"lambda_policy\" {","  name = \"lambda-sqs-s3-policy\"","  role = \"arn:aws:iam::244530008913:role/service-role/myRole-27\"","","  policy = jsonencode({","    Version = \"2012-10-17\"","    Statement = [","      # SQS-tilgang","      {","        Action = [","          \"sqs:ReceiveMessage\",","          \"sqs:DeleteMessage\",","          \"sqs:GetQueueAttributes\"","        ]","        Effect   = \"Allow\"","        Resource = aws_sqs_queue.image_processing_queue_27.arn","      },","      # S3-tilgang","      {","        Action = [","          \"s3:PutObject\"","        ]","        Effect   = \"Allow\"","        Resource = \"arn:aws:s3:::pgr301-couch-explorers/*\"","      },","      # Logging-tilgang","      {","        Action = [","          \"logs:CreateLogGroup\",","          \"logs:CreateLogStream\",","          \"logs:PutLogEvents\"","        ]","        Effect = \"Allow\"","        Resource = \"arn:aws:logs:*:*:*\"","      }","    ]","  })","}"],"id":17},{"start":{"row":24,"column":0},"end":{"row":61,"column":1},"action":"insert","lines":["resource \"aws_iam_role_policy\" \"lambda_policy\" {","  name = \"lambda-sqs-s3-policy\"","  role = \"arn:aws:iam::244530008913:role/service-role/myRole-27\"  # Dobbeltsjekk ARN-en her","","  policy = jsonencode({","    Version = \"2012-10-17\"","    Statement = [","      # SQS-tilgang","      {","        Action = [","          \"sqs:ReceiveMessage\",","          \"sqs:DeleteMessage\",","          \"sqs:GetQueueAttributes\"","        ]","        Effect   = \"Allow\"","        Resource = aws_sqs_queue.image_processing_queue_27.arn","      },","      # S3-tilgang","      {","        Action = [","          \"s3:PutObject\"","        ]","        Effect   = \"Allow\"","        Resource = \"arn:aws:s3:::pgr301-couch-explorers/*\"","      },","      # Logging-tilgang","      {","        Action = [","          \"logs:CreateLogGroup\",","          \"logs:CreateLogStream\",","          \"logs:PutLogEvents\"","        ]","        Effect = \"Allow\"","        Resource = \"arn:aws:logs:*:*:*\"","      }","    ]","  })","}"]}],[{"start":{"row":26,"column":64},"end":{"row":26,"column":91},"action":"remove","lines":["  # Dobbeltsjekk ARN-en her"],"id":18}],[{"start":{"row":26,"column":10},"end":{"row":26,"column":54},"action":"remove","lines":["arn:aws:iam::244530008913:role/service-role/"],"id":19}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":51,"column":18},"end":{"row":51,"column":18},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1732370300441,"hash":"e098d60e3d42991e45c84035c0f297d74c7c3317"}